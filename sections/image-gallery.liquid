{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and products_to_display > columns_mobile_int
    assign show_mobile_slider = true
  endif

  assign show_desktop_slider = false
  if section.settings.enable_desktop_slider and products_to_display > section.settings.columns_desktop
    assign show_desktop_slider = true
  endif
-%}


<div class="gallery-section">
  <div class="page-width">
  <slider-component class="slider-mobile-gutter{% if section.settings.full_width %} slider-component-full-width{% endif %}{% if show_mobile_slider == false %} page-width{% endif %}{% if show_desktop_slider == false and section.settings.full_width == false %} page-width-desktop{% endif %}{% if show_desktop_slider %} slider-component-desktop{% endif %}">
    <ul
      id="Slider-{{ section.id }}"
      class="image-gallery zoom-gallery grid product-grid contains-card contains-card--product{% if settings.card_style == 'standard' %} contains-card--standard{% endif %} grid--{{ section.settings.columns_desktop }}-col-desktop{% if section.settings.collection == blank %} grid--2-col-tablet-down{% else %} grid--{{ section.settings.columns_mobile }}-col-tablet-down{% endif %}{% if show_mobile_slider or show_desktop_slider %} slider{% if show_desktop_slider %} slider--desktop{% endif %}{% if show_mobile_slider %} slider--tablet grid--peek{% endif %}{% endif %}"
      role="list"
      aria-label="{{ 'general.slider.name' | t }}"
    >
         {% for block in section.blocks %}
          <li  id="Slide-{{ section.id }}-{{ forloop.index }}"
        class="grid__item{% if show_mobile_slider or show_desktop_slider %} slider__slide{% endif %}"> 
            <a href="{{ block.settings.image-gallery |  image_url: width:1024 }}" title="{{ block.settings.image-gallery.alt }}" data-source="http://500px.com/photo/32736307"  style="width:193px;height:125px;">
             <img src="{{ block.settings.image-gallery |  image_url: width:1024 }}" width="1024" height="1024" alt="{{ block.settings.image-gallery.alt }}" loading="lazy" />
            </a></li>
        {% endfor %} 
     </ul>
     {%- if show_mobile_slider or show_desktop_slider -%}
      <div class="slider-buttons no-js-hidden">
        <button
          type="button"
          class="slider-button slider-button--prev"
          name="previous"
          aria-label="{{ 'general.slider.previous_slide' | t }}"
          aria-controls="Slider-{{ section.id }}"
        >
          {% render 'icon-caret' %}
        </button>
        <div class="slider-counter caption">
          <span class="slider-counter--current">1</span>
          <span aria-hidden="true"> / </span>
          <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
          <span class="slider-counter--total">{{ products_to_display }}</span>
        </div>
        <button
          type="button"
          class="slider-button slider-button--next"
          name="next"
          aria-label="{{ 'general.slider.next_slide' | t }}"
          aria-controls="Slider-{{ section.id }}"
        >
          {% render 'icon-caret' %}
        </button>
      </div>
    {%- endif -%}
     </slider-component>
  </div>
</div>

<script>
    $(document).ready(function() {
	$('.zoom-gallery').magnificPopup({
		delegate: 'a',
		type: 'image',
		closeOnContentClick: false,
		closeBtnInside: false,
		mainClass: 'mfp-with-zoom mfp-img-mobile',
		image: {
			verticalFit: true,
			titleSrc: function(item) {
				return item.el.attr('title') + ' &middot; <a class="image-source-link" href="'+item.el.attr('data-source')+'" target="_blank">image source</a>';
			}
		},
		gallery: {
			enabled: true
		},
		zoom: {
			enabled: true,
			duration: 300, // don't foget to change the duration also in CSS
			opener: function(element) {
				return element.find('img');
			}
		}
		
	});
});
</script>

{% schema %}
{
  "name":"Image Gallery",
  "class":"image-pop-gallery",
  "settings":[
    {
      "type": "checkbox",
      "id": "enable_desktop_slider",
      "label": "t:sections.featured-collection.settings.enable_desktop_slider.label",
      "default": false
    }
  ],
  "blocks":[
    {
        "type":"image_picker",
        "name":"Image",
        "settings":[
            {
                "type":"image_picker",
                "id":"image-gallery",
                "label":"Image"
            }
        ]
    }
  ],
  "presets":[
    {
      "name":"Image Gallery"
    }
  ]
}
{% endschema %}    